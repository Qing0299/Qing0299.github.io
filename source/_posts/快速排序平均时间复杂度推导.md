---
title: 快速排序平均时间复杂度推导
mathjax: "true"
abbrlink: 13a59daf
date: 2023-12-20 11:09:26
categories:
  - 算法
tags:
  - 排序算法
cover: https://pic.linjq.top/img/default_post_cover.png
top_img: https://pic.linjq.top/img/top_img.jpg
description: 快速排序平均时间复杂度推导
auther: ljq
---

**引理1：** 当对$n$个元素的数组进行快速排序时，假设在划分元素时总共的比较次数为$X$，则快速排序的时间复杂度是$O(n+X)$。
&emsp;&emsp;由于在每次划分元素的过程中，都会选择一个元素作为分界，所以划分元素的过程至多发生$n$次。又由于划分元素的过程中比较的次数和其他基础操作的次数在一个数量级，所以总时间复杂度是$O(n+X)$的。
&emsp;&emsp;设$a_{i}$为原数组中第$i$小的数，定义$A_{i,j}$为$\{a_{i},a_{i+1},...,a_{j}\}$，$X_{i,j}$是一个取值为0或者1的离散随机变量表示在排序过程中$a_{i}$是否和$a_{j}$发生比较。
&emsp;&emsp;显然每次选取的分界值是不同的，而元素只会和分界值比较，所以总比较次数$$X=\sum_{i=1}^{n-1}\sum_{j=i+1}^{n}X_{i,j}$$
由期望的线性性，
$$E[X]=E[\sum_{i=1}^{n-1}\sum_{j=i+1}^{n}X_{i,j}]=\sum_{i=1}^{n-1}\sum_{j=i+1}^{n}E[X_{i,j}]=\sum_{i=1}^{n-1}\sum_{j=i+1}^{n}P(a_{i}和a_{j}比较)$$

**引理2：**$a_{i}$和$a_{j}$比较的充要条件是$a_{i}$或$a_{j}$是集合$A_{i,j}$中第一个被选中的分界值。
&emsp;&emsp;先证必要性，即若$a_{i}$和$a_{j}$都不是集合$A_{i,j}$中第一个被选中的分界值，则$a_{i}$不和$a_{j}$比较。
&emsp;&emsp;若$a_{i}$和$a_{j}$都不是集合$A_{i,j}$中第一个被选中的分界值，则一定存在一个$x$满足$i<x<j$，使得$a_{x}$是$A_{i,j}$中第一个被选中的分界值。在以$a_{x}$为分界值的划分中，$a_{i}$和 $a_{j}$被划分到数组的两个不同的子序列中，所以之后$a_{i}$和$a_{j}$一定不会比较。又因为元素只和分界值比较，所以$a_{i}$和$a_{j}$在此次划分前和划分中没有比较。所以$a_{i}$不和$a_{j}$比较。
&emsp;&emsp;再证充分性，即若$a_{i}$或$a_{j}$是集合$A_{i,j}$中第一个被选中的分界值，则$a_{i}$和$a_{j}$比较。
&emsp;&emsp;不失一般地，假设$a_{i}$是集合$A_{i,j}$中第一个被选中的分界值。由于$A_{i,j}$中没有其他数选为分界值，所以$A_{i,j}$中的元素都在数组的同一子序列中。在以$a_{i}$为分界值的划分中，$a_{i}$和当前子序列中所有元素都进行了比较，所以$a_{i}$和$a_{j}$进行了比较。
&emsp;&emsp;考虑计算$P(a_{i}和a_{j}比较)$。在$A_{i,j}$中某个元素被选为分界值之前，$A_{i,j}$中的元素都在数组的同一子序列中。所以$A_{i,j}$中每个元素都会被等可能地第一个被选为分界值。由于$A_{i,j}$中有$j-i+1$个元素，由引理 2，
$$P(a_{i}和a_{j}比较)=P(a_{i}或a_{j}是集合A_{i,j}中第一个被选中的分界值)=\frac{2}{j-i+1}$$
所以
$$E[X]=\sum_{i=1}^{n-1}\sum_{j=i+1}^{n}P(a_{i}和a_{j}比较)=\sum_{i=1}^{n-1}\sum_{j=i+1}^{n}\frac{2}{j-i+1}=\sum_{i=1}^{n-1}\sum_{k=2}^{n-i+1}\frac{2}{k}=\sum_{i=1}^{n-1}O(logn)=O(nlogn)$$
由此，快速排序的期望时间复杂度为$O(nlogn)$。

